<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor de Canales TV</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jwplayer/8.22.0/jwplayer.js"></script>
    <script>jwplayer.key = "XSuP4qMl+9tK17QNb+4+th2Pm9AWgMO/cYH8CI0HGGr7bdjo";</script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #0f0f1e;
            color: #fff;
            overflow-x: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .header {
            background: #1a1a2e;
            padding: 15px 20px;
            border-bottom: 1px solid #2d2d4d;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4cc9f0;
            text-shadow: 0 0 5px rgba(76, 201, 240, 0.5);
        }

        .now-playing {
            font-size: 1rem;
            color: #a0a0c0;
        }

        .player-container {
            flex: 1;
            background: #000;
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
        }

        #player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .player-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #0a0a1a;
            z-index: 5;
            transition: opacity 0.3s ease-in-out;
        }

        .player-placeholder.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .player-placeholder h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #4cc9f0;
        }

        .player-placeholder p {
            color: #a0a0c0;
            text-align: center;
            max-width: 80%;
        }

        .channels-container {
            padding: 20px;
            background: #131325;
        }

        .channels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .channel-card {
            background: #1e1e3a;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .channel-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .channel-card.active {
            border: 2px solid #4cc9f0;
        }

        .channel-card img {
            width: 100%;
            height: 80px;
            object-fit: cover;
            background: #2a2a4a;
        }

        .channel-card p {
            padding: 10px 5px;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #4cc9f0;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .channels-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }

            .channel-card img {
                height: 70px;
            }

            .channel-card p {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">TVStream</div>
            <div class="now-playing" id="now-playing">Selecciona un canal</div>
        </div>

        <div class="player-container">
            <div id="player"></div>
            <div class="player-placeholder" id="player-placeholder">
                <h3>Bienvenido a TVStream</h3>
                <p>Selecciona un canal de la lista para comenzar a ver</p>
            </div>
        </div>

        <div class="channels-container">
            <div class="channels-grid" id="channels-grid">
                </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canales = {
                "mtvlive": {
                    file: "//live1-ott.izzigo.tv/14/out/u/dash/MTV-LIVE-HD/default.mpd",
                    keyId: "acc4581a25ef0cd76f8fd7d826bb2d06",
                    key: "bc006e72e9aab57aca8ae75a83e8f20e",
                    title: "MTV Live",
                    logo: "https://logodownload.org/wp-content/uploads/2013/11/mtv-music-television-logo-1-1.png"
                },
                "espn1": {
                    file: "//live1-ott.izzigo.tv/11/out/u/dash/ESPN-HD/default.mpd",
                    keyId: "bb43112b7b72e9c287da0ecdec8606a7",
                    key: "29e3d2678107f0ab0b35b6537c734f2a",
                    title: "ESPN",
                    logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/ESPN_wordmark.svg/800px-ESPN_wordmark.svg.png"
                },
                "espn2": {
                    file: "//live1-ott.izzigo.tv/11/out/u/dash/ESPN-2-HD/default.mpd",
                    keyId: "90e2e491c850a49a5ab21bb6fa6b4d24",
                    key: "4d7e33da19b971cef49e35eccdb9de0b",
                    title: "ESPN 2",
                    logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/ESPN_wordmark.svg/800px-ESPN_wordmark.svg.png"
                },
                "espn3": {
                    file: "//live1-ott.izzigo.tv/11/out/u/dash/ESPN-3-HD/default.mpd",
                    keyId: "0355f64277082b903022985035c498ca",
                    key: "7a8ed20a4958398677e2c9ccd5a53a00",
                    title: "ESPN 3",
                    logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/ESPN_wordmark.svg/800px-ESPN_wordmark.svg.png"
                },
                "goldenedge": {
                    file: "//live1-ott.izzigo.tv/13/out/u/dash/GOLDEN-EDGE-SD/default.mpd",
                    keyId: "98aa90cb620b972a0d0d66a51cdaca56",
                    key: "6e8bd53378356ed7f5103d91efb5e54e",
                    title: "Golden Edge",
                    logo: "https://via.placeholder.com/150x80/2a2a4a/ffffff?text=Golden+Edge"
                },
                "foxsports1": {
                    file: "//live1-ott.izzigo.tv/11/out/u/dash/FOX-SPORTS-HD/default.mpd",
                    keyId: "9e276bd34034a2c4dcf61d74e1242fbf",
                    key: "4b466a4affb61d2672a4194b14e10ef2",
                    title: "Fox Sports",
                    logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3c/Fox_sports_logo.svg/640px-Fox_sports_logo.svg.png"
                },
                "hbo": {
                    file: "//live1-ott.izzigo.tv/15/out/u/dash/HBO-HD/default.mpd",
                    keyId: "df18f6a05bab28d89e5dc01d88f4deb8",
                    key: "baceb525467c0db22ba83090616c1ad0",
                    title: "HBO",
                    logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/de/HBO_logo.svg/1200px-HBO_logo.svg.png"
                }
            };
            
            const playerPlaceholder = document.getElementById("player-placeholder");
            const channelsGrid = document.getElementById("channels-grid");
            const nowPlaying = document.getElementById("now-playing");
            let playerInstance;

            function initJWPlayer() {
                // JWPlayer solo se inicializa una vez
                if (!playerInstance) {
                    playerInstance = jwplayer("player");
                    
                    playerInstance.on('ready', () => {
                        playerPlaceholder.classList.add('hidden');
                    });
                    
                    playerInstance.on('error', (e) => {
                        console.error("Error del reproductor:", e);
                        showPlaceholder(`
                            <h3>Error al cargar el canal</h3>
                            <p>Intenta seleccionar otro canal o vuelve a intentarlo más tarde</p>
                            <p style="font-size: 12px; margin-top: 10px;">Detalles: ${e.message || 'Error desconocido'}</p>
                        `, "Error");
                    });
                }
            }
            
            function showPlaceholder(htmlContent, title) {
                playerPlaceholder.innerHTML = htmlContent;
                playerPlaceholder.classList.remove('hidden');
                nowPlaying.textContent = title || "Selecciona un canal";
            }
            
            function loadChannel(channelId) {
                const c = canales[channelId];
                
                if (c) {
                    showPlaceholder(`
                        <h3>Cargando ${c.title}</h3>
                        <p>Por favor espera...</p>
                        <div class="loading" style="margin-top: 15px;"></div>
                    `, c.title);
                    
                    window.history.replaceState({}, '', `?channel=${channelId}`);
                    
                    document.querySelectorAll('.channel-card').forEach(item => item.classList.remove('active'));
                    const selectedCard = document.querySelector(`[data-channel="${channelId}"]`);
                    if (selectedCard) {
                        selectedCard.classList.add('active');
                    }
                    
                    initJWPlayer(); // Asegurarse de que el reproductor está inicializado
                    
                    playerInstance.load([{
                        title: c.title,
                        image: c.logo || "",
                        sources: [{
                            default: false,
                            type: "dash",
                            file: c.file,
                            drm: {
                                clearkey: {
                                    keyId: c.keyId,
                                    key: c.key
                                }
                            }
                        }]
                    }]);
                    playerInstance.play();
                } else {
                    showPlaceholder(`
                        <h3>Canal no disponible</h3>
                        <p>El canal "${channelId}" no se encuentra en nuestra lista</p>
                    `, "Canal no disponible");
                }
            }
            
            function createChannelCard(id, canal) {
                const card = document.createElement("div");
                card.className = "channel-card";
                card.dataset.channel = id;
                card.setAttribute('aria-label', `Reproducir canal ${canal.title}`);
                card.setAttribute('tabindex', '0');
                
                const img = document.createElement("img");
                img.src = canal.logo || "https://via.placeholder.com/150x80/2a2a4a/ffffff?text=TV";
                img.alt = `Logo de ${canal.title}`;
                img.onerror = function() {
                    this.src = `https://via.placeholder.com/150x80/2a2a4a/ffffff?text=${encodeURIComponent(canal.title.substring(0, 10))}`;
                };
                
                const title = document.createElement("p");
                title.textContent = canal.title;
                
                card.appendChild(img);
                card.appendChild(title);
                
                card.addEventListener("click", () => loadChannel(id));
                card.addEventListener("keydown", (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        loadChannel(id);
                    }
                });
                
                return card;
            }
            
            function renderChannelList() {
                channelsGrid.innerHTML = '';
                for (const [id, canal] of Object.entries(canales)) {
                    channelsGrid.appendChild(createChannelCard(id, canal));
                }
            }
            
            // Lógica de inicio
            renderChannelList();
            const canalParam = new URLSearchParams(window.location.search).get("channel");
            if (canalParam && canales[canalParam]) {
                loadChannel(canalParam);
            } else {
                showPlaceholder(`
                    <h3>Bienvenido a TVStream</h3>
                    <p>Selecciona un canal de la lista para comenzar a ver</p>
                `, "Selecciona un canal");
            }
        });
    </script>
</body>
</html>
